[#API_paybox]
== paybox

[#paybox_Introduction]
=== Introduction
[.clearfix]
--
[.right]
image::images/11-42-paybox/paybox_logo.png[paybox Logo, width=200]

_paybox_ is a payment system allowing a consumer to purchase goods and
services using a mobile phone. Consumers provide their mobile phone
number and set up a direct debit agreement with _paybox_ and select a
secret PIN for their _paybox_ account. In order to use _paybox_,
consumers need to have a bank account in Austria, Switzerland or the
European Economic Area. After a once-only registration, all payments are
debited to the consumer's bank account. For private consumers who have a
valid mobile phone contract with an Austrian mobile telephone provider,
online purchases via _paybox_ are included on the consumer's mobile phone
bill.

Before being able to offer _paybox_ as a payment method, the merchant
needs to sign an acceptance contract with _paybox._

When purchasing in an online shop, the consumer selects _paybox_ as the
preferred payment method and is prompted to enter a mobile phone number.
During the checkout process, _paybox_ calls the consumer's phone
(automated call), and asks for the PIN to confirm the transaction. After
entering the correct PIN, _paybox_ debits the money from the consumer's
bank account and credits it to the merchant's account. Finally, the
consumer receives an SMS message confirming the transaction. The
merchant also receives a confirmation and may thus proceed with the
delivery of the goods or services.
--

[#paybox_Advantages]
==== Advantages

- Easy to use.
- World-wide GSM radio networks ensure the highest level of security during data transfer.
- Consumers only need to give their bank details to the _paybox_ company
and do not need to reveal their credit card or bank account details to
any other company.

//-

[#paybox_GeneralInformation]
=== General Information

[#paybox_PaymentModeCountriesandCurrencies]
==== Payment Mode, Countries and Currencies

This table illustrates which payment mode _paybox_ belongs to. It also
provides detailed information about the countries and currencies which
are relevant for _paybox._

[%autowidth]
[cols="h,"]
|===
| Payment Mode | <<PaymentMethods_PaymentMode_OnlineBankTransfer, Online Bank Transfer>>, <<PaymentMethods_PaymentMode_MobilePayment, Mobile Payment>>
| Countries    | Austria
| Currencies   | EUR
|===


[#paybox_CommunicationFormats]
==== Communication Formats

This table illustrates how _paybox_ notifications are encoded and
which formats and methods can be used for requests and responses.

|===
.2+| *Requests/Responses* | Format  | XML
                          | Methods | POST
| *IPN Encodement*      2+| Please follow the instructions given at
<<GeneralPlatformFeatures_IPN, Instant Payment Notification>> to set up IPN.
|===


[#paybox_TransactionTypes]
=== Transaction Types

For <<Glossary_TransactionType, transaction type>> details look at <<AppendixB,  Transaction Types>>.

[cols="20, 60, 20"]
|===
| Transaction Type | Description | Link to the Sample

| _authorization_ | Reserves funds on a consumer's account until the
merchant ships the product/service.
| <<paybox_Samples_Authorization, _authorization_ samples>>
| _capture-authorization_ | Used to capture the reserved funds at the
moment when some or all goods are physically delivered to the consumer.
| <<paybox_Samples_CaptureAuthorization, _capture-authorization_ samples>>
| _purchase_ | An immediate payment for online purchase. | <<paybox_Samples_Purchase, _purchase_ samples>>
| _refund-capture_ | Used when the consumer wishes to return some or all
delivered goods. | <<paybox_Samples_RefundCapture, _refund-capture_ samples>>
| _refund-purchase_ | Used when the consumer wishes to return some or all
delivered goods. | <<paybox_Samples_RefundPurchase, _refund-purchase_ samples>>
| _void-authorization_ | Used when the consumer wishes to cancel some or
all (not yet shipped) items from the order. | <<paybox_Samples_VoidAuthorization, _void-authorization_ samples>>
| _void-purchase_ | Used when the consumer wishes to cancel some or all
(not yet shipped) items from the order. | <<paybox_Samples_VoidPurchase, _void-purchase_ samples>>
|===


[#paybox_TestCredentials]
=== Test Credentials

[cols="20, 50, 30"]
|===
.2+s| URLs (Endpoints) | For transaction types _authorization_ and _purchase._ | ``\https://{test-instance-hostname}/engine/rest/paymentmethods/``
                      | For transaction types _void-authorization_, _void-purchase_, _refund-capture_ and _refund-purchase._
                      | ``\https://{test-instance-hostname}/engine/rest/payments/``
s| Merchant Account ID (MAID) 2+| Please contact <<ContactUs, merchant support>> for complete test credentials.
s| Username   2+| Please contact <<ContactUs, merchant support>> for complete test credentials.
s| Password   2+| Please contact <<ContactUs, merchant support>> for complete test credentials.
s| Secret Key 2+| Please contact <<ContactUs, merchant support>> for complete test credentials.
|===


[#paybox_Workflow]
=== Workflow

WARNING: Be aware that initial _paybox_ _authorization/purchase_ transactions have
a long timeout (190 seconds). _paybox_ calls the consumer to authorize
the transfer. Synchronous http-calls are used in _paybox_ interface
which are kept alive until confirmation.

[#paybox_Workflow_AuthorizationPurchase]
==== _authorization, purchase_

image::images/11-42-paybox/paybox_workflow_AuthorizationPurchase.png[Authorization Purchase Workflow]

. Consumer adds items to the shopping basket and selects _paybox._
. Consumer provides the phone number.
. The merchant sends an _authorization-purchase_ request to _{payment-gateway} ({payment-gateway-abbr})._
. _{payment-gateway-abbr}_ processes and validates the transaction.
. _{payment-gateway-abbr}_ sends a request to _paybox._
. _paybox_ calls or sends SMS to consumer to verify the amount and payee information.
. Consumer approves the transaction. The approval is done via _paybox_ PIN (when called) or typing "JA" (when receiving an SMS).
. _paybox_ processes consumer's reply.
. _paybox_ sends the transaction status to _{payment-gateway-abbr}._
. _{payment-gateway-abbr}_ forwards transaction status to the merchant.
. The merchant displays the completion of the payment process to the consumer.

//-

[#paybox_Workflow_OtherTransactionTypes]
==== _void-authorization, capture-authorization, void-purchase, refund-capture, refund-purchase_

image::images/11-42-paybox/paybox_workflow_OtherTransactionTypes.png[Workflow Other Transaction Types]

. The merchant initiates a request (either _void-authorization, capture-authorization, void-purchase, refund-capture_ or _refund-purchase_).
. {payment-gateway-abbr} processes and validates the transaction.
. _{payment-gateway-abbr}_ sends the request to _paybox._
. _paybox_ processes the transaction.
. _paybox_ sends the transaction status to _{payment-gateway-abbr}._
. _{payment-gateway-abbr}_ forwards the transaction status to the merchant.

//-


[#paybox_Fields]
=== Fields

The fields used for _paybox_ requests, responses and notifications are
the same as the REST API fields. Please refer to <<RestApi_Fields, REST API Fields>>.
Only the fields listed below have different properties, especially
according to size.

[#paybox_Fields_AuthorizationPurchase]
==== _authorization, purchase_

The following elements are mandatory (M), optional (O) or conditional
\(C) for a request/response/notification. If the respective cell is
empty, the field is disregarded or not sent.

[%autowidth]
|===
| Field | Cardinality | Datatype | Size | Description

| order-number | O | xs:string | 40 | This is the order number of the merchant.
| descriptor   | O | xs:string | 60 |Description on the settlement of the
account holder's account about a transaction.
| account-holder/phone | M | xs:string | 24 |The phone number of the account holder.
|===


[#paybox_Samples]
=== Samples

[#paybox_Samples_Authorization]
==== _authorization_

.XML _authorization_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_authorization_request_success.xml[]
----

.XML _authorization_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_authorization_response_success_de.xml[]
----

.XML _authorization_ Response (Failure)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_authorization_response_failure.xml[]
----

[#paybox_Samples_CaptureAuthorization]
==== _capture-authorization_

.XML _capture-authorization_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_capture-authorization_request_success_31af95ca.xml[]
----

.XML _capture-authorization_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_capture-authorization_response_success.xml[]
----

[#paybox_Samples_Purchase]
==== _purchase_

.XML _purchase_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_purchase_request_success.xml[]
----

.XML _purchase_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_purchase_response_success.xml[]
----

[#paybox_Samples_RefundCapture]
==== _refund-capture_

.XML _refund-capture_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_refund-capture_request_success_321d784f.xml[]
----

.XML _refund-capture_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_refund-capture_response_success.xml[]
----

[#paybox_Samples_RefundPurchase]
==== _refund-purchase_

.XML _refund-purchase_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_refund-purchase_request_success_264082a3.xml[]
----

.XML _refund-purchase_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_refund-purchase_response_success.xml[]
----

[#paybox_Samples_VoidAuthorization]
==== _void-authorization_

.XML _void-authorization_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_void-authorization_request_success_d6e3497e.xml[]
----

.XML _void-authorization_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_void-authorization_response_success.xml[]
----

[#paybox_Samples_VoidPurchase]
==== _void-purchase_

.XML _void-purchase_ Request (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_void-purchase_request_success_c391dd8f.xml[]
----

.XML _void-purchase_ Response (Successful)

[source,xml,subs=attributes+]
----
include::/{base_dir}/samples/xml/paybox_void-purchase_response_success.xml[]
----
